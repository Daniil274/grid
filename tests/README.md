# –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Grid

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∞–≥–µ–Ω—Ç–æ–≤ Grid, –≤–∫–ª—é—á–∞—é—â–∞—è –º–æ–¥—É–ª—å–Ω—ã–µ, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã.

## üÜï –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ coverage
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è HTML, XML, JSON –æ—Ç—á–µ—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–æ—Ä–æ–≥–∏ –ø–æ–∫—Ä—ã—Ç–∏—è
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤ –∫–æ–¥–∞

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ security —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç—ã –¥–ª—è SecurityGuardian
- –ü—Ä–æ–≤–µ—Ä–∫–∞ ContextQualityAgent  
- –ê–Ω–∞–ª–∏–∑ TaskAnalyzer
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ security —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ API —Ç–µ—Å—Ç—ã
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ OpenAI-compatible endpoints
- –¢–µ—Å—Ç—ã middleware –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- Performance –∏ stress —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ API —Å—Ü–µ–Ω–∞—Ä–∏–∏

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ conftest.py                    # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ pytest
‚îú‚îÄ‚îÄ coverage_runner.py             # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç–∏—è
‚îú‚îÄ‚îÄ config_test.yaml              # –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ config_qa.yaml               # QA –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ 
‚îú‚îÄ‚îÄ test_framework.py             # –ë–∞–∑–æ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ enhanced_test_framework.py    # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
‚îú‚îÄ‚îÄ 
‚îú‚îÄ‚îÄ test_agents.py               # –¢–µ—Å—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ test_tools.py                # –¢–µ—Å—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ test_context.py              # –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚îú‚îÄ‚îÄ test_enhanced_features.py    # –¢–µ—Å—Ç—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ 
‚îú‚îÄ‚îÄ test_security.py             # üÜï Security —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ test_api_comprehensive.py    # üÜï –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ API —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ test_integration.py          # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ test_integration_lmstudio.py # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LMStudio
‚îú‚îÄ‚îÄ test_openai_compat.py        # OpenAI —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
‚îú‚îÄ‚îÄ 
‚îú‚îÄ‚îÄ run_tests.py                 # –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—É—Å–∫–∞—é—â–∏–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ qa_test_runner.py            # QA —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö
‚îú‚îÄ‚îÄ mock_tools.py                # –ú–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ README.md                    # –î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Grid
pip install -r requirements.txt

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
pip install pytest pytest-asyncio coverage fastapi httpx
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± - —á–µ—Ä–µ–∑ coverage runner
python tests/coverage_runner.py

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã
python tests/run_tests.py
pytest tests/ -v

# –° –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º –ø–æ–∫—Ä—ã—Ç–∏—è
coverage run -m pytest tests/
coverage report -m
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–µ—Å—Ç–æ–≤

```bash
# üÜï –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ pytest
pytest -m "unit"              # –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
pytest -m "integration"       # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "security"          # Security —Ç–µ—Å—Ç—ã
pytest -m "api"               # API —Ç–µ—Å—Ç—ã
pytest -m "not slow"          # –ò—Å–∫–ª—é—á–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

# –ß–µ—Ä–µ–∑ coverage runner
python tests/coverage_runner.py --markers "unit"
python tests/coverage_runner.py --markers "security"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã
python tests/coverage_runner.py --pattern "tests/test_security.py"
```

## üìã –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. Unit —Ç–µ—Å—Ç—ã
–ë—ã—Å—Ç—Ä—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
- `test_agents.py` - –¢–µ—Å—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤
- `test_tools.py` - –¢–µ—Å—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤  
- `test_context.py` - –¢–µ—Å—Ç—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `test_enhanced_features.py` - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 2. üÜï Security —Ç–µ—Å—Ç—ã (`test_security.py`)
–ü—Ä–æ–≤–µ—Ä—è—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã:
- **SecurityGuardian**: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
- **ContextQualityAgent**: –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **TaskAnalyzer**: –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–∏—Å–∫–æ–≤
- **SecurityAwareFactory**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤

```python
@pytest.mark.security
@pytest.mark.asyncio
async def test_security_guardian_creation():
    async with AgentTestEnvironment() as env:
        guardian = SecurityGuardian(env.config)
        assert guardian is not None
```

### 3. üÜï API —Ç–µ—Å—Ç—ã (`test_api_comprehensive.py`)
–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:
- **OpenAI Compatible**: Chat/Completions endpoints
- **Streaming**: –ü–æ—Ç–æ–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã
- **Agent Management**: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–≥–µ–Ω—Ç–∞–º–∏
- **System API**: Health checks –∏ —Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **Middleware**: Authentication, Rate limiting, Security
- **Performance**: –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
@pytest.mark.api
def test_chat_completions_endpoint():
    with patch('core.agent_factory.AgentFactory') as mock_factory:
        response = client.post("/v1/chat/completions", json={
            "model": "test_simple_agent",
            "messages": [{"role": "user", "content": "–ü—Ä–∏–≤–µ—Ç"}]
        })
        assert response.status_code == 200
```

### 4. Integration —Ç–µ—Å—Ç—ã
–ü—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
- End-to-end —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üÜï –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è

### Coverage Runner

–ù–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `coverage_runner.py` –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è:

```bash
# –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
python tests/coverage_runner.py

# –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
python tests/coverage_runner.py \
    --pattern "tests/test_agents.py" \
    --markers "unit" \
    --format "html" \
    --verbose

# –¢–æ–ª—å–∫–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ (–±–µ–∑ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤)
python tests/coverage_runner.py --no-tests --format "all"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
python tests/coverage_runner.py --install-deps
```

### –§–æ—Ä–º–∞—Ç—ã –æ—Ç—á–µ—Ç–æ–≤
- `terminal` - –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏
- `html` - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π HTML –æ—Ç—á–µ—Ç
- `xml` - XML –¥–ª—è CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏  
- `json` - JSON –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `all` - –í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```
üìà –°–í–û–î–ö–ê –ü–û–ö–†–´–¢–ò–Ø –ö–û–î–ê
============================================================
üéâ –û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 92% - –û–¢–õ–ò–ß–ù–û
‚úÖ core/: 95% –ø–æ–∫—Ä—ã—Ç–∏–µ
‚ö†Ô∏è security_agents/: 78% –ø–æ–∫—Ä—ã—Ç–∏–µ (–ù–£–ñ–ù–û –£–õ–£–ß–®–ò–¢–¨)
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

### üÜï –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest (`pytest.ini`)

```ini
[pytest]
addopts = -q --tb=short --strict-markers
markers =
    unit: marks tests as unit tests
    integration: marks tests as integration tests  
    security: marks tests as security-related
    api: marks tests as API tests
    performance: marks tests as performance tests
    slow: marks tests as slow running

# Coverage configuration
[coverage:run]
source = .
omit = tests/*, venv/*, .venv/*

[coverage:report]
show_missing = true
precision = 2
exclude_lines =
    pragma: no cover
    def __repr__
    raise NotImplementedError
```

### üÜï –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã (`conftest.py`)

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

```python
@pytest.fixture
async def test_environment():
    """–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞."""
    async with AgentTestEnvironment() as env:
        yield env

@pytest.fixture  
def mock_openai_client():
    """–ú–æ–∫ OpenAI –∫–ª–∏–µ–Ω—Ç–∞."""
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ API
```

## üîß –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### 1. Security —Ç–µ—Å—Ç

```python
@pytest.mark.security
@pytest.mark.asyncio
async def test_input_validation():
    async with AgentTestEnvironment() as env:
        guardian = SecurityGuardian(env.config)
        
        # –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–≤–æ–¥
        safe_input = "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?"
        assert await guardian.validate_input(safe_input) is True
        
        # –û–ø–∞—Å–Ω—ã–π –≤–≤–æ–¥
        dangerous_input = "rm -rf /"
        assert await guardian.validate_input(dangerous_input) is False
```

### 2. API —Ç–µ—Å—Ç

```python
@pytest.mark.api
def test_new_api_endpoint():
    client = TestClient(app)
    response = client.get("/new/endpoint")
    
    assert response.status_code == 200
    assert response.json()["status"] == "success"
```

### 3. Performance —Ç–µ—Å—Ç

```python
@pytest.mark.performance
def test_concurrent_requests():
    import threading
    
    results = []
    def make_request():
        response = client.get("/system/health")
        results.append(response.status_code)
    
    threads = [threading.Thread(target=make_request) for _ in range(10)]
    for t in threads: t.start()
    for t in threads: t.join()
    
    assert all(status == 200 for status in results)
```

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. üÜï –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
```python
@pytest.mark.unit          # –ë—ã—Å—Ç—Ä—ã–µ unit —Ç–µ—Å—Ç—ã
@pytest.mark.integration   # –ú–µ–¥–ª–µ–Ω–Ω—ã–µ integration —Ç–µ—Å—Ç—ã  
@pytest.mark.security      # Security-related —Ç–µ—Å—Ç—ã
@pytest.mark.api           # API —Ç–µ—Å—Ç—ã
@pytest.mark.performance   # Performance —Ç–µ—Å—Ç—ã
@pytest.mark.slow          # –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

### 2. –§–∏–∫—Å—Ç—É—Ä—ã
```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏–∑ conftest.py
async def test_with_environment(test_environment):
    # test_environment –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ –æ—á–∏—â–∞–µ—Ç—Å—è
    response = await test_environment.agent_factory.run_agent(...)
```

### 3. –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –º–æ–∫–∏
def test_with_mock_client(mock_openai_client):
    # –ö–ª–∏–µ–Ω—Ç —É–∂–µ –∑–∞–º–æ–∫–∞–Ω
    mock_openai_client.chat.completions.create.return_value = {...}
```

## üìä –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è

### –ü–æ—Ä–æ–≥–∏ –ø–æ–∫—Ä—ã—Ç–∏—è
- **90%+**: –û—Ç–ª–∏—á–Ω–æ üéâ
- **80-89%**: –•–æ—Ä–æ—à–æ ‚úÖ  
- **70-79%**: –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ ‚ö†Ô∏è
- **<70%**: –ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å ‚ùå

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Ü–µ–ª—å 90%+)
- `core/` - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `api/` - API endpoints
- `security_agents/` - Security –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ú–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ (—Ü–µ–ª—å 70%+)
- `utils/` - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
- `tools/` - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

## üîÑ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### GitHub Actions

```yaml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-asyncio coverage
      
      - name: Run tests with coverage
        run: |
          python tests/coverage_runner.py --format xml
      
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v1
```

### –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ö—É–∫–∏

```bash
# pre-commit —Ö—É–∫
#!/bin/sh
python tests/coverage_runner.py --markers "unit" --format terminal
if [ $? -ne 0 ]; then
    echo "‚ùå Unit —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏. –ö–æ–º–º–∏—Ç –æ—Ç–º–µ–Ω–µ–Ω."
    exit 1
fi
```

## üö® –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ó–∞–ø—É—Å–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º

```bash
# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
python tests/coverage_runner.py --verbose

# Pytest —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest tests/ -v -s

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç —Å –æ—Ç–ª–∞–¥–∫–æ–π
pytest tests/test_security.py::TestSecurityGuardian::test_input_validation -v -s
```

### –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è

```bash
# –¢–æ–ª—å–∫–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
python tests/coverage_runner.py --no-tests --format html

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã—Ö —Å—Ç—Ä–æ–∫
coverage report -m --skip-covered
```

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

```bash
# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest --durations=10

# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "not slow"
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- –ü–æ–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ failed/passed —Ç–µ—Å—Ç–æ–≤
- –ê–Ω–∞–ª–∏–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤

### –û—Ç—á–µ—Ç—ã
- HTML dashboard —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
- XML –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CI/CD
- JSON –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Grid —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è pytest**  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è**  
‚úÖ **Security —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**  
‚úÖ **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ API —Ç–µ—Å—Ç—ã**  
‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è**  
‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**  
‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**  

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `python tests/coverage_runner.py` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è!